import 'dart:async';

import 'package:async_redux/async_redux.dart';
import 'package:flutter/widgets.dart';
import 'app_state.dart';

/// To access the state inside of widgets, you can use `StoreProvider.of`. For example:
///
/// ```
/// // Read state
/// var myInfo = StoreProvider.state<AppState>(context).myInfo;
///
/// // Dispatch action
/// StoreProvider.dispatch<AppState>(context, MyAction());
/// ```
///
/// However, this extension allows you to write the above code like this:
///
/// ```
/// // Read state
/// var myInfo = context.state.myInfo;
///
/// // Dispatch action
/// context.dispatch(MyAction());
/// ```
extension BuildContextExtension on BuildContext {
  //

  /// You can access the store state from inside your widgets, using the context:
  /// ```
  /// context.state.myInfo;
  /// ```
  AppState get state => StoreProvider.state<AppState>(this);

  /// Runs the action, applying its reducer, and possibly changing the store state.
  /// The action may be sync or async. Note: [dispatch] is of type [Dispatch].
  ///
  /// Use it like this:
  /// ```
  /// context.dispatch(MyAction());
  /// ```
  FutureOr<ActionStatus> dispatch(ReduxAction<AppState> action, {bool notify = true}) => StoreProvider.dispatch(this, action, notify: notify);

  /// Runs the action, applying its reducer, and possibly changing the store state.
  /// Note: [dispatchAndWait] is of type [DispatchAndWait]. It returns `Future<ActionStatus>`,
  /// which means you can `await` it.
  ///
  /// Use it like this:
  /// ```
  /// context.dispatchAndWait(MyAction());
  /// ```
  Future<ActionStatus> dispatchAndWait(ReduxAction<AppState> action, {bool notify = true}) => StoreProvider.dispatchAndWait(this, action, notify: notify);

  /// Runs the action, applying its reducer, and possibly changing the store state.
  /// Note: [dispatchSync] is of type [DispatchSync].
  /// If the action is async, it will throw a [StoreException].
  ///
  /// Use it like this:
  /// ```
  /// context.dispatchSync(MySyncAction());
  /// ```
  ActionStatus dispatchSync(ReduxAction<AppState> action, {bool notify = true}) => StoreProvider.dispatchSync(this, action, notify: notify);
}
